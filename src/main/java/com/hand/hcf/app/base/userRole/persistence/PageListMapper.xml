<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hand.hcf.app.base.userRole.persistence.PageListMapper">


    <select id="listPageByRoleIds" resultType="com.hand.hcf.app.base.userRole.dto.FunctionPageDTO">
        SELECT v.page_name,
        t.function_id,
        t.page_id,
        v.file_path,
        v.content_router,
        v.function_router,
        v.page_router,
        v.page_url,
        v.full_router as fullRouter,
        v.full_url as fullUrl,
        cfr.content_id
        FROM sys_page_list v
        inner join sys_function_page_relation t on t.page_id = v.id
        left join sys_content_function_rel cfr on t.function_id = cfr.function_id
        WHERE v.deleted = 0
        AND exists (select 1 from sys_role_function rf where rf.function_id = t.function_id
            <if test="roleIds != null and roleIds.size > 0">
                AND rf.role_id in
                <foreach collection="roleIds" item="roleId" open="(" separator="," close=")">
                    #{roleId}
                </foreach>
            </if>)
    </select>
</mapper>
