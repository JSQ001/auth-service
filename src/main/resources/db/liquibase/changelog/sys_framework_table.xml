<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">
    <property name="now" value="now()" dbms="mysql,h2"/>
    <property name="now" value="sysdate" dbms="oracle"/>
    <property name="show" value="1" dbms="oracle"/>
    <property name="show" value="true" dbms="mysql"/>
    <property name="autoIncrement" value="true" dbms="mysql,h2,postgresql,oracle"/>
    <!--  前端新框架需要用到的相关表 -->
    <changeSet id="201808201053001" author="houyin.zhang">
        <createTable tableName="sys_module" remarks="模块表">
            <column name="id" type="bigint" remarks="模块id">
                <constraints nullable="false"
                             primaryKey="true"
                             primaryKeyName="pk_module_id"/>
            </column>
            <column name="module_code" type="varchar(100)" remarks="模块代码">
                <constraints nullable="false"
                             unique="true"
                             uniqueConstraintName="id_unq_sys_module_code"/>
            </column>
            <column name="module_name" type="varchar(50)" remarks="模块名称">
                <constraints nullable="false"/>
            </column>
            <column name="version_number" type="int" remarks="版本号">
                <constraints nullable="false"/>
            </column>
            <column name="enabled" type="boolean" remarks="是否启用">
                <constraints nullable="false"/>
            </column>
            <column name="deleted" type="boolean" remarks="是否删除">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="timestamp" remarks="创建日期" defaultValue="${now}">
                <constraints nullable="false"/>
            </column>
            <column name="created_by" type="bigint" remarks="创建用户id">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_date" type="timestamp" defaultValue="${now}" remarks="最后更新日期">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_by" type="bigint" remarks="最后更新用户id">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <!--  添加索引 -->
        <createIndex indexName="idx_module_code_deleted" tableName="sys_module">
            <column name="module_code"/>
            <column name="deleted"/>
        </createIndex>

        <createTable tableName="sys_component" remarks="系统组件表">
            <column name="id" type="bigint" remarks="组件id">
                <constraints nullable="false"
                             primaryKey="true"
                             primaryKeyName="pk_component_id"/>
            </column>
            <column name="component_name" type="varchar(50)" remarks="组件名称">
                <constraints nullable="false"/>
            </column>
            <column name="component_type" type="int" remarks="组件类型 1为组件,2为界面">
                <constraints nullable="true"/>
            </column>
            <column name="version_number" type="int" remarks="版本号">
                <constraints nullable="false"/>
            </column>
            <column name="enabled" type="boolean" remarks="是否启用">
                <constraints nullable="false"/>
            </column>
            <column name="deleted" type="boolean" remarks="是否删除">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="timestamp" remarks="创建日期" defaultValue="${now}">
                <constraints nullable="false"/>
            </column>
            <column name="created_by" type="bigint" remarks="创建用户id">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_date" type="timestamp" defaultValue="${now}" remarks="最后更新日期">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_by" type="bigint" remarks="最后更新用户id">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <!--  添加索引 -->
        <createIndex indexName="idx_component_type" tableName="sys_component">
            <column name="component_type"/>
        </createIndex>

        <createTable tableName="sys_component_version" remarks="组件版本表">
            <column name="id" type="bigint" remarks="id">
                <constraints nullable="false"
                             primaryKey="true"
                             primaryKeyName="pk_version_id"/>
            </column>
            <column name="component_id" type="bigint" remarks="组件ID">
                <constraints nullable="false"/>
            </column>
            <column name="remark" type="varchar(2000)" remarks="备注说明">
            </column>
            <column name="contents" type="varchar(2000)"  remarks="内容信息">
                <constraints nullable="false"/>
            </column>
            <column name="version_number" type="int" remarks="版本号">
                <constraints nullable="false"/>
            </column>
            <column name="enabled" type="boolean" remarks="是否启用">
                <constraints nullable="false"/>
            </column>
            <column name="deleted" type="boolean" remarks="是否删除">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="timestamp" remarks="创建日期" defaultValue="${now}">
                <constraints nullable="false"/>
            </column>
            <column name="created_by" type="bigint" remarks="创建用户id">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_date" type="timestamp" defaultValue="${now}" remarks="最后更新日期">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_by" type="bigint" remarks="最后更新用户id">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <!--  添加索引 -->
        <createIndex indexName="idx_sys_component_id" tableName="sys_component_version">
            <column name="component_id"/>
        </createIndex>

        <createTable tableName="sys_interface" remarks="接口管理表">
            <column name="id" type="bigint" remarks="id">
                <constraints nullable="false"
                             primaryKey="true"
                             primaryKeyName="pk_interface_id"/>
            </column>
            <column name="module_id" type="bigint" remarks="模块id">
                <constraints nullable="false"/>
            </column>
            <column name="interface_name" type="varchar(200)" remarks="接口名称">
                <constraints nullable="false"/>
            </column>
            <column name="request_protocol" type="varchar(50)" remarks="请求协议">
            </column>
            <column name="request_method" type="varchar(30)" remarks="请求方法">
            </column>
            <column name="request_format" type="varchar(30)" remarks="请求格式">
            </column>
            <column name="req_url" type="varchar(150)" remarks="请求URL">
            </column>
            <column name="response_format" type="varchar(30)" remarks="响应格式">
            </column>
            <column name="remark" type="varchar(30)" remarks="备注说明">
            </column>
            <column name="version_number" type="int" remarks="版本号">
                <constraints nullable="false"/>
            </column>
            <column name="enabled" type="boolean" remarks="是否启用">
                <constraints nullable="false"/>
            </column>
            <column name="deleted" type="boolean" remarks="是否删除">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="timestamp" remarks="创建日期" defaultValue="${now}">
                <constraints nullable="false"/>
            </column>
            <column name="created_by" type="bigint" remarks="创建用户id">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_date" type="timestamp" defaultValue="${now}" remarks="最后更新日期">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_by" type="bigint" remarks="最后更新用户id">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <!--  添加索引 -->
        <createIndex indexName="idx_module_deleted_id" tableName="sys_interface">
            <column name="module_id"/>
            <column name="deleted"/>
        </createIndex>
        <createIndex indexName="idx_interface_name" tableName="sys_interface">
            <column name="interface_name"/>
        </createIndex>

        <createTable tableName="sys_front_key" remarks="系统语言表">
            <column name="id" type="bigint" remarks="id">
                <constraints nullable="false"
                             primaryKey="true"
                             primaryKeyName="pk_sys_front_key_id"/>
            </column>
            <column name="module_id" type="bigint" remarks="模块id">
                <constraints nullable="false"/>
            </column>
            <column name="key_code" type="varchar(100)" remarks="界面Key值">
                <constraints nullable="false"/>
            </column>
            <column name="lang" type="varchar(100)" remarks="语言">
            </column>
            <column name="descriptions" type="varchar(100)" remarks="语言描述">
            </column>
            <column name="version_number" type="int" remarks="版本号">
                <constraints nullable="false"/>
            </column>
            <column name="enabled" type="boolean" remarks="是否启用">
                <constraints nullable="false"/>
            </column>
            <column name="deleted" type="boolean" remarks="是否删除">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="timestamp" remarks="创建日期" defaultValue="${now}">
                <constraints nullable="false"/>
            </column>
            <column name="created_by" type="bigint" remarks="创建用户id">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_date" type="timestamp" defaultValue="${now}" remarks="最后更新日期">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_by" type="bigint" remarks="最后更新用户id">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <!--  添加索引 -->
        <createIndex indexName="idx_sys_front_module_id" tableName="sys_front_key">
            <column name="module_id"/>
            <column name="deleted"/>
        </createIndex>
        <createIndex indexName="idx_sys_front_key" tableName="sys_front_key">
            <column name="key_code"/>
        </createIndex>
        <createTable tableName="sys_interface_request" remarks="接口请求参数表">
            <column name="id" type="bigint" remarks="id">
                <constraints nullable="false"
                             primaryKey="true"
                             primaryKeyName="pk_sys_request_id"/>
            </column>
            <column name="interface_id" type="bigint" remarks="接口表ID">
                <constraints nullable="false"/>
            </column>
            <column name="parent_id" type="bigint" remarks="上级id">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="varchar(100)" remarks="请求名称">
            </column>
            <column name="req_type" type="varchar(50)" remarks="参数类型">
            </column>
            <column name="position" type="varchar(50)" remarks="参数位置">
            </column>
            <column name="key_code" type="varchar(50)" remarks="代码">
            </column>
            <column name="remark" type="varchar(500)" remarks="备注说明">
            </column>
            <column name="version_number" type="int" remarks="版本号">
                <constraints nullable="false"/>
            </column>
            <column name="enabled" type="boolean" remarks="是否启用">
                <constraints nullable="false"/>
            </column>
            <column name="deleted" type="boolean" remarks="是否删除">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="timestamp" remarks="创建日期" defaultValue="${now}">
                <constraints nullable="false"/>
            </column>
            <column name="created_by" type="bigint" remarks="创建用户id">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_date" type="timestamp" defaultValue="${now}" remarks="最后更新日期">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_by" type="bigint" remarks="最后更新用户id">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <!--  添加索引 -->
        <createIndex indexName="idx_sys_request_inter_id" tableName="sys_interface_request">
            <column name="interface_id"/>
            <column name="deleted"/>
        </createIndex>
        <createIndex indexName="idx_sys_request_code" tableName="sys_interface_request">
            <column name="key_code"/>
        </createIndex>

        <createTable tableName="sys_interface_response" remarks="响应参数表">
            <column name="id" type="bigint" remarks="id">
                <constraints nullable="false"
                             primaryKey="true"
                             primaryKeyName="pk_sys_response_id"/>
            </column>
            <column name="interface_id" type="bigint" remarks="接口表ID">
                <constraints nullable="false"/>
            </column>
            <column name="parent_id" type="bigint" remarks="上级id">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="varchar(100)" remarks="响应名称">
            </column>
            <column name="resp_type" type="varchar(50)" remarks="响应类型">
            </column>
            <column name="key_code" type="varchar(50)" remarks="代码">
            </column>
            <column name="remark" type="varchar(500)" remarks="备注说明">
            </column>
            <column name="version_number" type="int" remarks="版本号">
                <constraints nullable="false"/>
            </column>
            <column name="enabled" type="boolean" remarks="是否启用">
                <constraints nullable="false"/>
            </column>
            <column name="deleted" type="boolean" remarks="是否删除">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="timestamp" remarks="创建日期" defaultValue="${now}">
                <constraints nullable="false"/>
            </column>
            <column name="created_by" type="bigint" remarks="创建用户id">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_date" type="timestamp" defaultValue="${now}" remarks="最后更新日期">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_by" type="bigint" remarks="最后更新用户id">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <!--  添加索引 -->
        <createIndex indexName="idx_sys_response_inter_id" tableName="sys_interface_response">
            <column name="interface_id"/>
            <column name="deleted"/>
        </createIndex>
        <createIndex indexName="idx_sys_response_code" tableName="sys_interface_response">
            <column name="key_code"/>
        </createIndex>
    </changeSet>
    <changeSet id="2018082017230002" author="houyin.zhang">
        <!-- 添加索引 -->
        <createIndex indexName="idx_code_deleted_enabled" tableName="sys_module">
            <column name="module_code"/>
            <column name="deleted"/>
            <column name="enabled"/>
        </createIndex>
        <createIndex indexName="idx_component_type_enabled" tableName="sys_component">
            <column name="component_type"/>
            <column name="enabled"/>
        </createIndex>
        <createIndex indexName="idx_sys_component_id_enabled" tableName="sys_component_version">
            <column name="component_id"/>
            <column name="enabled"/>
        </createIndex>
        <createIndex indexName="idx_module_deleted_enabled_id" tableName="sys_interface">
            <column name="module_id"/>
            <column name="deleted"/>
            <column name="enabled"/>
        </createIndex>
        <createIndex indexName="idx_interface_name_enabled" tableName="sys_interface">
            <column name="interface_name"/>
            <column name="enabled"/>
        </createIndex>
        <createIndex indexName="idx_sys_lang_module_enabled" tableName="sys_front_key">
            <column name="module_id"/>
            <column name="deleted"/>
            <column name="enabled"/>
        </createIndex>
        <createIndex indexName="idx_language_key_enabled" tableName="sys_front_key">
            <column name="key_code"/>
            <column name="enabled"/>
        </createIndex>
        <createIndex indexName="idx_sys_request_enabled" tableName="sys_interface_request">
            <column name="interface_id"/>
            <column name="deleted"/>
            <column name="enabled"/>
        </createIndex>
        <createIndex indexName="idx_sys_requestId_enabled" tableName="sys_interface_request">
            <column name="key_code"/>
            <column name="enabled"/>
        </createIndex>
        <createIndex indexName="idx_sys_response_inter_enable" tableName="sys_interface_response">
            <column name="interface_id"/>
            <column name="deleted"/>
            <column name="enabled"/>
        </createIndex>
        <createIndex indexName="idx_sys_response_enabled" tableName="sys_interface_response">
            <column name="key_code"/>
            <column name="enabled"/>
        </createIndex>
        <addUniqueConstraint tableName="sys_front_key" columnNames="key_code,lang" constraintName="udx_front_key_lang"/>
    </changeSet>
    <changeSet id="201808210001" author="houyin.zhang">
        <createTable tableName="sys_language_enabled" remarks="语言启用记录表">
            <column name="id" type="bigint" remarks="id">
                <constraints nullable="false"
                             primaryKey="true"
                             primaryKeyName="pk_language_enabled_id"/>
            </column>
            <column name="language" type="varchar(50)" remarks="语言 中文 zh_CN 英文 eu">
            </column>
            <column name="version_number" type="int" remarks="版本号">
                <constraints nullable="false"/>
            </column>
            <column name="enabled" type="boolean" remarks="是否启用">
                <constraints nullable="false"/>
            </column>
            <column name="deleted" type="boolean" remarks="是否删除">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="timestamp" remarks="创建日期" defaultValue="${now}">
                <constraints nullable="false"/>
            </column>
            <column name="created_by" type="bigint" remarks="创建用户id">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_date" type="timestamp" defaultValue="${now}" remarks="最后更新日期">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_by" type="bigint" remarks="最后更新用户id">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <createIndex indexName="idx_sys_language_enabled" tableName="sys_language_enabled">
            <column name="language"/>
            <column name="enabled"/>
        </createIndex>
    </changeSet>
    <changeSet id="2018082410580001" author="houyin.zhang">
        <comment>组件中添加菜单关联字段并增加索引</comment>
        <addColumn tableName="sys_component">
            <column name="menu_id" type="bigint" remarks="菜单menu_id"/>
        </addColumn>
        <createIndex indexName="idx_sys_component_menu_id" tableName="sys_component">
            <column name="menu_id"/>
        </createIndex>
        <createIndex indexName="idx_sys_component_menu_enabled" tableName="sys_component">
            <column name="menu_id"/>
            <column name="deleted"/>
            <column name="enabled"/>
        </createIndex>
    </changeSet>
    <changeSet id="2018082920330001" author="houyin.zhang">
        <comment>接口请求中添加默认值字段</comment>
        <addColumn tableName="sys_interface_request">
            <column name="default_value" type="varchar(200)" remarks="默认值"/>
        </addColumn>
    </changeSet>
    <changeSet id="2018083020330001" author="houyin.zhang">
        <comment>接口请求中添加必填和唯一性两个字段</comment>
        <addColumn tableName="sys_interface_request">
            <column name="required_flag" type="boolean" remarks="必填标识"/>
            <column name="union_flag" type="boolean" remarks="唯一标识"/>
        </addColumn>
    </changeSet>
</databaseChangeLog>