<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">
    <property name="now" value="now()" dbms="mysql,h2"/>
    <property name="now" value="sysdate" dbms="oracle"/>
    <property name="show" value="1" dbms="oracle"/>
    <property name="show" value="true" dbms="mysql"/>
    <property name="autoIncrement" value="true" dbms="mysql,h2,postgresql,oracle"/>

    <changeSet id="201810121200001" author="kai.zhang">
        <createTable tableName="sys_data_authority" remarks="数据权限定义表">
            <column name="id" type="bigint" remarks="ID">
                <constraints nullable="false"
                             primaryKey="true"
                             primaryKeyName="pk_sys_data_authority"/>
            </column>
            <column name="tenant_id" type="bigint" remarks="租户ID">
                <constraints nullable="false"/>
            </column>
            <column name="data_authority_code" type="varchar(50)" remarks="数据权限代码">
                <constraints nullable="false"/>
            </column>
            <column name="data_authority_name" type="varchar(500)" remarks="数据权限名称">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="varchar(2000)" remarks="数据权限说明"/>
            <column name="version_number" type="int" remarks="版本号">
                <constraints nullable="false"/>
            </column>
            <column name="enabled" type="boolean" remarks="是否启用">
                <constraints nullable="false"/>
            </column>
            <column name="deleted" type="boolean" remarks="是否删除">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="timestamp" remarks="创建日期" defaultValue="${now}">
                <constraints nullable="false"/>
            </column>
            <column name="created_by" type="bigint" remarks="创建用户id">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_date" type="timestamp" defaultValue="${now}" remarks="最后更新日期">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_by" type="bigint" remarks="最后更新用户id">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <createIndex tableName="sys_data_authority" indexName="data_authority_n1">
            <column name="tenant_id"></column>
        </createIndex>
        <createIndex tableName="sys_data_authority" indexName="data_authority_u1" unique="true">
            <column name="tenant_id"></column>
            <column name="data_authority_code"></column>
        </createIndex>
        <createTable tableName="sys_data_authority_i18n" remarks="数据权限定义多语言表">
            <column name="id" type="bigint"/>
            <column name="language" type="varchar(20)" remarks="语言"/>
            <column name="data_authority_name" type="varchar(500)" remarks="数据权限名称"/>
        </createTable>
        <addPrimaryKey tableName="sys_data_authority_i18n" columnNames="id,language" constraintName="pk_data_auth_i18n"></addPrimaryKey>
    </changeSet>
    
    <changeSet id="201810121200002" author="kai.zhang">
        <createTable tableName="sys_data_authority_rule" remarks="数据权限规则表">
            <column name="id" type="bigint" remarks="ID">
                <constraints nullable="false"
                             primaryKey="true"
                             primaryKeyName="pk_data_authority_rule"/>
            </column>
            <column name="data_authority_id" type="bigint" remarks="数据权限ID">
                <constraints nullable="false"/>
            </column>
            <column name="data_authority_rule_name" type="varchar(500)" remarks="数据权限规则名称">
                <constraints nullable="false"/>
            </column>
            <column name="version_number" type="int" remarks="版本号">
                <constraints nullable="false"/>
            </column>
            <column name="deleted" type="boolean" remarks="是否删除">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="timestamp" remarks="创建日期" defaultValue="${now}">
                <constraints nullable="false"/>
            </column>
            <column name="created_by" type="bigint" remarks="创建用户id">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_date" type="timestamp" defaultValue="${now}" remarks="最后更新日期">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_by" type="bigint" remarks="最后更新用户id">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <createIndex tableName="sys_data_authority_rule" indexName="data_authority_rule_n1">
            <column name="data_authority_id"></column>
        </createIndex>
        <createTable tableName="sys_data_authority_rule_i18n" remarks="数据权限定义多语言表">
            <column name="id" type="bigint"/>
            <column name="language" type="varchar(20)" remarks="语言"/>
            <column name="data_authority_rule_name" type="varchar(500)" remarks="数据权限名称"/>
        </createTable>
        <addPrimaryKey tableName="sys_data_authority_rule_i18n" columnNames="id,language" constraintName="pk_data_auth_rule_i18n"></addPrimaryKey>
    </changeSet>
    
    <changeSet id="201810121200003" author="kai.zhang">
        <createTable tableName="sys_data_auth_rule_detail" remarks="数据权限规则明细表">
            <column name="id" type="bigint" remarks="ID">
                <constraints nullable="false"
                             primaryKey="true"
                             primaryKeyName="pk_data_auth_rule_detail"/>
            </column>
            <column name="data_authority_rule_id" type="bigint" remarks="数据权限规则ID">
                <constraints nullable="false"/>
            </column>
            <column name="data_type" type="varchar(30)" remarks="数据类型">
                <constraints nullable="false"/>
            </column>
            <column name="data_scope" type="varchar(30)" remarks="数据范围">
                <constraints nullable="false"/>
            </column>
            <column name="filtrate_method" type="varchar(30)" remarks="取值方式">
                <constraints nullable="false"/>
            </column>
            <column name="version_number" type="int" remarks="版本号">
                <constraints nullable="false"/>
            </column>
            <column name="deleted" type="boolean" remarks="是否删除">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="timestamp" remarks="创建日期" defaultValue="${now}">
                <constraints nullable="false"/>
            </column>
            <column name="created_by" type="bigint" remarks="创建用户id">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_date" type="timestamp" defaultValue="${now}" remarks="最后更新日期">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_by" type="bigint" remarks="最后更新用户id">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <createIndex tableName="sys_data_auth_rule_detail" indexName="data_auth_rule_detail_n1">
            <column name="data_authority_rule_id"></column>
        </createIndex>
    </changeSet>

    <changeSet id="201810121200004" author="kai.zhang">
        <createTable tableName="sys_data_auth_rule_del_value" remarks="数据权限规则明细值表">
            <column name="id" type="bigint" remarks="ID">
                <constraints nullable="false"
                             primaryKey="true"
                             primaryKeyName="pk_data_auth_rule_del_value"/>
            </column>
            <column name="data_auth_rule_detail_id" type="bigint" remarks="数据权限规则明细ID">
                <constraints nullable="false"/>
            </column>
            <column name="value_key" type="varchar(500)" remarks="规则明细值">
                <constraints nullable="false"/>
            </column>
            <column name="deleted" type="boolean" remarks="是否删除">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="timestamp" remarks="创建日期" defaultValue="${now}">
                <constraints nullable="false"/>
            </column>
            <column name="created_by" type="bigint" remarks="创建用户id">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_date" type="timestamp" defaultValue="${now}" remarks="最后更新日期">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_by" type="bigint" remarks="最后更新用户id">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <createIndex tableName="sys_data_auth_rule_del_value" indexName="data_auth_rule_del_value_n1">
            <column name="data_auth_rule_detail_id"></column>
        </createIndex>
    </changeSet>

    <changeSet id="201810151427001" author="kai.zhang">
        <dropColumn tableName="sys_data_auth_rule_del_value" columnName="deleted"/>
    </changeSet>
    <changeSet id="201810161634001" author="kai.zhang">
        <addColumn tableName="sys_data_auth_rule_del_value">
            <column name="version_number" type="int" defaultValue="1" remarks="版本号">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="201810151427002" author="kai.zhang">
        <addColumn tableName="sys_data_auth_rule_detail">
            <column name="data_authority_id" type="bigint" remarks="数据权限ID" />
        </addColumn>
        <addColumn tableName="sys_data_auth_rule_del_value">
            <column name="data_authority_id" type="bigint" remarks="数据权限ID" />
        </addColumn>
    </changeSet>

    <changeSet id="201810231710001" author="kai.zhang">
        <createTable tableName="sys_data_auth_table_property" remarks="数据权限表配置">
            <column name="id" type="bigint" remarks="ID">
                <constraints nullable="false"
                             primaryKey="true"
                             primaryKeyName="pk_sys_data_auth_table_pro"/>
            </column>
            <column name="table_name" type="varchar(50)" remarks="表名">
                <constraints nullable="false"/>
            </column>
            <column name="filter_method" type="varchar(30)" remarks="筛选方式">
                <constraints nullable="false"/>
            </column>
            <column name="data_type" type="varchar(50)" remarks="数据类型">
                <constraints nullable="false"/>
            </column>
            <column name="column_name" type="varchar(50)" remarks="匹配列名称">
                <constraints nullable="false"/>
            </column>
            <column name="custom_sql" type="longtext" remarks="自定义sql" />
            <column name="enabled" type="boolean" remarks="是否启用">
                <constraints nullable="false"/>
            </column>
            <column name="version_number" type="int" remarks="版本号">
                <constraints nullable="false"/>
            </column>
            <column name="created_date" type="timestamp" remarks="创建日期" defaultValue="${now}">
                <constraints nullable="false"/>
            </column>
            <column name="created_by" type="bigint" remarks="创建用户id">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_date" type="timestamp" defaultValue="${now}" remarks="最后更新日期">
                <constraints nullable="false"/>
            </column>
            <column name="last_updated_by" type="bigint" remarks="最后更新用户id">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <createIndex tableName="sys_data_auth_table_property" unique="true" indexName="sys_data_auth_table_pro_u1">
            <column name="table_name"></column>
            <column name="data_type"></column>
        </createIndex>
        <createIndex tableName="sys_data_auth_table_property" unique="true" indexName="sys_data_auth_table_pro_u2">
            <column name="table_name"></column>
            <column name="column_name"></column>
        </createIndex>
    </changeSet>

    <changeSet id="201811091637001" author="kai.zhang">
        <dropNotNullConstraint tableName="sys_data_auth_rule_detail" columnName="filtrate_method"/>
    </changeSet>

</databaseChangeLog>